% \documentclass[tikz,14pt,border=10pt]{standalone}
% 
% \usepackage{verbatim}
% \usepackage{bm}
% 
% \usetikzlibrary{%
%   arrows,%
%   shapes.misc,% wg. rounded rectangle
%   shapes.arrows,%
%   chains,%
%   matrix,%
%   positioning,% wg. " of "
%   scopes,%
%   decorations.pathmorphing,% /pgf/decoration/random steps | erste Graphik
%   shadows%
% }
% \begin{document}

\definecolor{c1}{HTML}{8097e9}
\definecolor{c2}{HTML}{c6dea2}
\definecolor{c3}{HTML}{ffb200}
\definecolor{c4}{HTML}{b6b6b6}

\tikzset{
  function/.style={
    % The shape:
    rectangle,
    rounded corners=3,
    % The size:
    minimum height=6mm,
    % The border:
    thick,
    draw=black,
    % The filling:
    top color=c1,
    bottom color=c1,
    % Font
    font=\tt
  },
  vector/.style={
    % The shape:
    rounded rectangle,
    minimum size=6mm,
    % The rest
    thick,draw=black,
    top color=c2!80,
    bottom color=c2!80,
    font=\ttfamily
  },
  trainable/.style={
    % The shape:
    diamond,
    rounded corners=3,
    minimum size=6mm,
    % The rest
    thick,draw=black,
    top color=c3!80,
    bottom color=c3!80,
    font=\ttfamily
  },
  skip loop/.style={to path={-- ++(0,#1) -| (\tikztotarget)}}
}

{
  \tikzset{vector/.append style={text height=1.5ex,text depth=.25ex}}
  \tikzset{function/.append style={text height=1.5ex,text depth=.25ex}}
}

\begin{tikzpicture}[
        point/.style={coordinate},>=stealth',thick,draw=black!90,
        tip/.style={->,shorten >=0.007pt},every join/.style={rounded corners},
        fat/.style={-, ultra thick, opacity=0.5},every join/.style={rounded corners},
        hv path/.style={to path={-| (\tikztotarget)}},
        vh path/.style={to path={|- (\tikztotarget)}},
        path/.style={to path={-- (\tikztotarget)}},
        text height=1.5ex,text depth=.25ex]

  \matrix[column sep=3mm, row sep=1mm] {
    & & \node (add) [function] {$\mathrm{add}$}; &
    \node (a) [vector] {$\bm a$}; \\

    \node (x) [vector] {$\bm x$}; &
    \node (W) [trainable] {$\bm W$}; &
    \node (tanhs) [function] {$\mathrm{tanh}\sigma$};&
    \node (g) [trainable] {$\bm g$}; & &
    \node (gate) [function] {$\mathrm{gate}$}; & &
    \node (y) [vector] {$\bm y$};\\
    
    & \node (M) [trainable] {$\bm M$}; &\\

    & & \node (mult) [function] {$\mathrm{mult}$}; &
    \node (m) [vector] {$\bm m$}; \\
  };

  { [start chain]
    \chainin (x);
    \chainin (mult) [join=by {vh path, tip}];
    \chainin (m) [join=by path];
    \chainin (gate) [join=by {hv path, tip}];
  }

  { [start chain]
    \chainin (x);
    \chainin (add) [join=by {vh path, tip}];
    \chainin (a) [join=by path];
    \chainin (gate) [join=by {hv path, tip}];
    \chainin (y) [join=by {tip}];
  }

  { [start chain]
    \chainin (W);
    \chainin (tanhs) [join=by tip];
    \chainin (add) [join=by tip];
  }
  { [start chain]
    \chainin (M);
    \chainin (tanhs) [join=by tip];
    \chainin (mult) [join=by tip];
  }
  { [start chain]
    \chainin (g);
    \chainin (gate) [join=by tip];
  }



\end{tikzpicture}

% \end{document}
